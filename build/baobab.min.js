/*
 * Baobab
 *
 * Homepage: https://github.com/Yomguithereal/baobab
 * Version: 2.4.3
 * Author: Yomguithereal (Guillaume Plique)
 * License: MIT
 */
<<<<<<< HEAD
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Baobab=t()}}(function(){var t;return function t(e,n,r){function o(a,s){if(!n[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var h=n[a]={exports:{}};e[a][0].call(h.exports,function(t){var n=e[a][1][t];return o(n?n:t)},h,h.exports,t,e,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,n,r){(function(){"use strict";function e(t,e){var n,r={};for(n in t)r[n]=t[n];for(n in e)r[n]=e[n];return r}function o(t){return t&&"object"==typeof t&&!Array.isArray(t)&&!(t instanceof Function)&&!(t instanceof RegExp)}function i(t,e,n){var r,o,i,a;for(o in t)e.call(n||null,o,t[o]);if(Object.getOwnPropertySymbols)for(r=Object.getOwnPropertySymbols(t),i=0,a=r.length;i<a;i++)e.call(n||null,r[i],t[r[i]])}function a(t,e){t=t||[];var n,r,o=[];for(r=0,n=t.length;r<n;r++)t[r].fn!==e&&o.push(t[r]);return o}var s={once:"boolean",scope:"object"},u=0,l=function(){this._enabled=!0,this.unbindAll()};l.prototype.unbindAll=function(){return this._handlers={},this._handlersAll=[],this._handlersComplex=[],this},l.prototype.on=function(t,e,n){var r,a,l,h,f,c,p;if(o(t))return i(t,function(t,n){this.on(t,n,e)},this),this;for("function"==typeof t&&(n=e,e=t,t=null),f=[].concat(t),r=0,a=f.length;r<a;r++){if(h=f[r],p={order:u++,fn:e},"string"==typeof h||"symbol"==typeof h)this._handlers[h]||(this._handlers[h]=[]),c=this._handlers[h],p.type=h;else if(h instanceof RegExp)c=this._handlersComplex,p.pattern=h;else{if(null!==h)throw Error("Emitter.on: invalid event.");c=this._handlersAll}for(l in n||{})s[l]&&(p[l]=n[l]);c.push(p)}return this},l.prototype.once=function(){var t=Array.prototype.slice.call(arguments),n=t.length-1;return o(t[n])&&t.length>1?t[n]=e(t[n],{once:!0}):t.push({once:!0}),this.on.apply(this,t)},l.prototype.off=function(t,e){var n,r,s,u;if(1===arguments.length&&"function"==typeof t){e=arguments[0];for(s in this._handlers)this._handlers[s]=a(this._handlers[s],e),0===this._handlers[s].length&&delete this._handlers[s];this._handlersAll=a(this._handlersAll,e),this._handlersComplex=a(this._handlersComplex,e)}else if(1!==arguments.length||"string"!=typeof t&&"symbol"!=typeof t)if(2===arguments.length){var l=[].concat(t);for(n=0,r=l.length;n<r;n++)u=l[n],this._handlers[u]=a(this._handlers[u],e),0===(this._handlers[u]||[]).length&&delete this._handlers[u]}else o(t)&&i(t,this.off,this);else delete this._handlers[t];return this},l.prototype.listeners=function(t){var e,n,r,o=this._handlersAll||[],i=!1;if(!t)throw Error("Emitter.listeners: no event provided.");for(o=o.concat(this._handlers[t]||[]),n=0,r=this._handlersComplex.length;n<r;n++)e=this._handlersComplex[n],~t.search(e.pattern)&&(i=!0,o.push(e));return this._handlersAll.length||i?o.sort(function(t,e){return t.order-e.order}):o.slice(0)},l.prototype.emit=function(t,e){if(!this._enabled)return this;if(o(t))return i(t,this.emit,this),this;var n,r,a,s,u,l,h,f,c=[].concat(t),p=[];for(u=0,h=c.length;u<h;u++){for(a=this.listeners(c[u]),l=0,f=a.length;l<f;l++)s=a[l],n={type:c[u],target:this},arguments.length>1&&(n.data=e),s.fn.call("scope"in s?s.scope:this,n),s.once&&p.push(s);for(l=p.length-1;l>=0;l--)r=p[l].type?this._handlers[p[l].type]:p[l].pattern?this._handlersComplex:this._handlersAll,r.splice(r.indexOf(p[l]),1)}return this},l.prototype.kill=function(){this.unbindAll(),this._handlers=null,this._handlersAll=null,this._handlersComplex=null,this._enabled=!1,this.unbindAll=this.on=this.once=this.off=this.emit=this.listeners=Function.prototype},l.prototype.disable=function(){return this._enabled=!1,this},l.prototype.enable=function(){return this._enabled=!0,this},l.version="3.1.1","undefined"!=typeof r?("undefined"!=typeof n&&n.exports&&(r=n.exports=l),r.Emitter=l):"function"==typeof t&&t.amd?t("emmett",[],function(){return l}):this.Emitter=l}).call(this)},{}],2:[function(t,e,n){"use strict";function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function o(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function u(t){return"λ"+t.map(function(t){return m.default.function(t)||m.default.object(t)?"#"+z()+"#":t}).join("λ")}n.__esModule=!0,n.helpers=n.type=n.Monkey=n.MonkeyDefinition=n.Cursor=n.dynamicNode=n.monkey=void 0;var l=t("emmett"),h=o(l),f=t("./cursor"),c=o(f),p=t("./monkey"),d=t("./watcher"),y=o(d),v=t("./type"),m=o(v),g=t("./update"),b=o(g),_=t("./helpers"),w=r(_),k=w.arrayFrom,P=w.coercePath,j=w.deepFreeze,M=w.getIn,C=w.makeError,E=w.deepClone,O=w.deepMerge,x=w.shallowClone,B=w.shallowMerge,z=w.uniqid,D={autoCommit:!0,asynchronous:!0,immutable:!0,lazyMonkeys:!0,persistent:!0,pure:!0,validate:null,validationBehavior:"rollback"},A=function(t){function e(n,r){i(this,e);var o=a(this,t.call(this));if(arguments.length<1&&(n={}),!m.default.object(n)&&!m.default.array(n))throw C("Baobab: invalid data.",{data:n});o.options=B({},D,r),o.options.persistent||(o.options.immutable=!1,o.options.pure=!1),o._identity="[object Baobab]",o._cursors={},o._future=null,o._transaction=[],o._affectedPathsIndex={},o._monkeys={},o._previousData=null,o._data=n,o.root=new c.default(o,[],"λ"),delete o.root.release,o.options.immutable&&j(o._data);var s=function(t){o[t]=function(){var e=this.root[t].apply(this.root,arguments);return e instanceof c.default?this:e}};["apply","clone","concat","deepClone","deepMerge","exists","get","push","merge","pop","project","serialize","set","shift","splice","unset","unshift"].forEach(s),o._refreshMonkeys();var u=o.validate();if(u)throw Error("Baobab: invalid data.",{error:u});return o}return s(e,t),e.prototype._refreshMonkeys=function(t,e,n){var r=this,o=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e instanceof p.Monkey)return e.release(),void(0,b.default)(r._monkeys,n,{type:"unset"},{immutable:!1,persistent:!1,pure:!1});if(m.default.object(e))for(var o in e)t(e[o],n.concat(o))},i=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e instanceof p.MonkeyDefinition||e instanceof p.Monkey){var o=new p.Monkey(r,n,e instanceof p.Monkey?e.definition:e);return void(0,b.default)(r._monkeys,n,{type:"set",value:o},{immutable:!1,persistent:!1,pure:!1})}if(m.default.object(e))for(var i in e)t(e[i],n.concat(i))};if(arguments.length){var a=M(this._monkeys,e).data;a&&o(a,e),"unset"!==n&&i(t,e)}else i(this._data);return this},e.prototype.validate=function t(e){var n=this.options,t=n.validate,r=n.validationBehavior;if("function"!=typeof t)return null;var o=t.call(this,this._previousData,this._data,e||[[]]);return o instanceof Error?("rollback"===r&&(this._data=this._previousData,this._affectedPathsIndex={},this._transaction=[],this._previousData=this._data),this.emit("invalid",{error:o}),o):null},e.prototype.select=function(t){if(t=t||[],arguments.length>1&&(t=k(arguments)),!m.default.path(t))throw C("Baobab.select: invalid path.",{path:t});t=[].concat(t);var e=u(t),n=this._cursors[e];return n||(n=new c.default(this,t,e),this._cursors[e]=n),this.emit("select",{path:t,cursor:n}),n},e.prototype.update=function(t,e){var n=this;if(t=P(t),!m.default.operationType(e.type))throw C('Baobab.update: unknown operation type "'+e.type+'".',{operation:e});var r=M(this._data,t),o=r.solvedPath,i=r.exists;if(!o)throw C("Baobab.update: could not solve the given path.",{path:o});var a=m.default.monkeyPath(this._monkeys,o);if(a&&o.length>a.length)throw C("Baobab.update: attempting to update a read-only path.",{path:o});if("unset"!==e.type||i){var s=e;if(/merge/i.test(e.type)){var l=M(this._monkeys,o).data;if(m.default.object(l)){s=x(s);var h=M(this._data,o).data;/deep/i.test(s.type)?s.value=O({},O({},h,E(l)),s.value):s.value=B({},O({},h,E(l)),s.value)}}this._transaction.length||(this._previousData=this._data);var f=(0,b.default)(this._data,o,s,this.options),c=f.data,p=f.node;if(!("data"in f))return p;var d=o.concat("push"===e.type?p.length-1:[]),y=u(d);return this._data=c,this._affectedPathsIndex[y]=!0,this._transaction.push(B({},e,{path:d})),this._refreshMonkeys(p,o,e.type),this.emit("write",{path:d}),this.options.autoCommit?this.options.asynchronous?(this._future||(this._future=setTimeout(function(){return n.commit()},0)),p):(this.commit(),p):p}},e.prototype.commit=function(){if(!this._transaction.length)return this;this._future&&(this._future=clearTimeout(this._future));var t=Object.keys(this._affectedPathsIndex).map(function(t){return"λ"!==t?t.split("λ").slice(1):[]}),e=this.validate(t);if(e)return this;var n=this._transaction,r=this._previousData;return this._affectedPathsIndex={},this._transaction=[],this._previousData=this._data,this.emit("update",{paths:t,currentData:this._data,transaction:n,previousData:r}),this},e.prototype.getMonkey=function(t){t=P(t);var e=M(this._monkeys,[].concat(t)).data;return e instanceof p.Monkey?e:null},e.prototype.watch=function(t){return new y.default(this,t)},e.prototype.release=function(){var t=void 0;this.emit("release"),delete this.root,delete this._data,delete this._previousData,delete this._transaction,delete this._affectedPathsIndex,delete this._monkeys;for(t in this._cursors)this._cursors[t].release();delete this._cursors,this.kill()},e.prototype.toJSON=function(){return this.serialize()},e.prototype.toString=function(){return this._identity},e}(h.default);n.default=A;var I=n.monkey=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(!e.length)throw new Error("Baobab.monkey: missing definition.");return 1===e.length&&"function"!=typeof e[0]?new p.MonkeyDefinition(e[0]):new p.MonkeyDefinition(e)};n.dynamicNode=I,n.Cursor=c.default,n.MonkeyDefinition=p.MonkeyDefinition,n.Monkey=p.Monkey,n.type=m.default,n.helpers=w,A.VERSION="2.3.4"},{"./cursor":3,"./helpers":4,"./monkey":5,"./type":6,"./update":7,"./watcher":8,emmett:1}],3:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e){if(!e)throw(0,d.makeError)("Baobab.Cursor."+t+": "+("cannot use "+t+" on an unresolved dynamic path."),{path:e})}function u(t,e){y.prototype[t]=function(n,r){if(arguments.length>2)throw(0,d.makeError)("Baobab.Cursor."+t+": too many arguments.");if(1!==arguments.length||v[t]||(r=n,n=[]),n=(0,d.coercePath)(n),!p.default.path(n))throw(0,d.makeError)("Baobab.Cursor."+t+": invalid path.",{path:n});if(e&&!e(r))throw(0,d.makeError)("Baobab.Cursor."+t+": invalid value.",{path:n,value:r});if(!this.solvedPath)throw(0,d.makeError)("Baobab.Cursor."+t+": the dynamic path of the cursor cannot be solved.",{path:this.path});var o=this.solvedPath.concat(n);return this.tree.update(o,{type:t,value:r})}}n.__esModule=!0;var l=t("emmett"),h=r(l),f=t("./monkey"),c=t("./type"),p=r(c),d=t("./helpers"),y=function(t){function e(n,r,a){o(this,e);var s=i(this,t.call(this));r=r||[],s._identity="[object Cursor]",s._archive=null,s.tree=n,s.path=r,s.hash=a,s.state={killed:!1,recording:!1,undoing:!1},s._dynamicPath=p.default.dynamicPath(s.path),s._monkeyPath=p.default.monkeyPath(s.tree._monkeys,s.path),s._dynamicPath?s.solvedPath=(0,d.getIn)(s.tree._data,s.path).solvedPath:s.solvedPath=s.path,s._writeHandler=function(t){var e=t.data;!s.state.killed&&(0,d.solveUpdate)([e.path],s._getComparedPaths())&&(s.solvedPath=(0,d.getIn)(s.tree._data,s.path).solvedPath)};var u=function(t){var e=s,n={get previousData(){return(0,d.getIn)(t,e.solvedPath).data},get currentData(){return e.get()}};return s.state.recording&&!s.state.undoing&&s.archive.add(n.previousData),s.state.undoing=!1,s.emit("update",n)};s._updateHandler=function(t){if(!s.state.killed){var e=t.data,n=e.paths,r=e.previousData,o=u.bind(s,r),i=s._getComparedPaths();return(0,d.solveUpdate)(n,i)?o():void 0}};var l=!1;return s._lazyBind=function(){if(!l)return l=!0,s._dynamicPath&&s.tree.on("write",s._writeHandler),s.tree.on("update",s._updateHandler)},s._dynamicPath?s._lazyBind():(s.on=(0,d.before)(s._lazyBind,s.on.bind(s)),s.once=(0,d.before)(s._lazyBind,s.once.bind(s))),s}return a(e,t),e.prototype._getComparedPaths=function(){var t=this._monkeyPath?(0,d.getIn)(this.tree._monkeys,this._monkeyPath).data.relatedPaths():[];return[this.solvedPath].concat(t)},e.prototype.isRoot=function(){return!this.path.length},e.prototype.isLeaf=function(){return p.default.primitive(this._get().data)},e.prototype.isBranch=function(){return!this.isRoot()&&!this.isLeaf()},e.prototype.root=function(){return this.tree.select()},e.prototype.select=function(t){return arguments.length>1&&(t=(0,d.arrayFrom)(arguments)),this.tree.select(this.path.concat(t))},e.prototype.up=function(){return this.isRoot()?null:this.tree.select(this.path.slice(0,-1))},e.prototype.down=function(){if(s("down",this.solvedPath),!(this._get().data instanceof Array))throw Error("Baobab.Cursor.down: cannot go down on a non-list type.");return this.tree.select(this.solvedPath.concat(0))},e.prototype.left=function(){s("left",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.left: cannot go left on a non-list type.");return t?this.tree.select(this.solvedPath.slice(0,-1).concat(t-1)):null},e.prototype.right=function(){s("right",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.right: cannot go right on a non-list type.");return t+1===this.up()._get().data.length?null:this.tree.select(this.solvedPath.slice(0,-1).concat(t+1))},e.prototype.leftmost=function(){s("leftmost",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.leftmost: cannot go left on a non-list type.");return this.tree.select(this.solvedPath.slice(0,-1).concat(0))},e.prototype.rightmost=function(){s("rightmost",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.rightmost: cannot go right on a non-list type.");var e=this.up()._get().data;return this.tree.select(this.solvedPath.slice(0,-1).concat(e.length-1))},e.prototype.map=function(t,e){s("map",this.solvedPath);var n=this._get().data,r=arguments.length;if(!p.default.array(n))throw Error("baobab.Cursor.map: cannot map a non-list type.");return n.map(function(o,i){return t.call(r>1?e:this,this.select(i),i,n)},this)},e.prototype._get=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!p.default.path(t))throw(0,d.makeError)("Baobab.Cursor.getters: invalid path.",{path:t});return this.solvedPath?(0,d.getIn)(this.tree._data,this.solvedPath.concat(t)):{data:void 0,solvedPath:null,exists:!1}},e.prototype.exists=function(t){return t=(0,d.coercePath)(t),arguments.length>1&&(t=(0,d.arrayFrom)(arguments)),this._get(t).exists},e.prototype.get=function(t){t=(0,d.coercePath)(t),arguments.length>1&&(t=(0,d.arrayFrom)(arguments));var e=this._get(t),n=e.data,r=e.solvedPath;return this.tree.emit("get",{data:n,solvedPath:r,path:this.path.concat(t)}),n},e.prototype.clone=function(){var t=this.get.apply(this,arguments);return(0,d.shallowClone)(t)},e.prototype.deepClone=function(){var t=this.get.apply(this,arguments);return(0,d.deepClone)(t)},e.prototype.serialize=function(t){if(t=(0,d.coercePath)(t),arguments.length>1&&(t=(0,d.arrayFrom)(arguments)),!p.default.path(t))throw(0,d.makeError)("Baobab.Cursor.getters: invalid path.",{path:t});if(this.solvedPath){var e=this.solvedPath.concat(t),n=(0,d.deepClone)((0,d.getIn)(this.tree._data,e).data),r=(0,d.getIn)(this.tree._monkeys,e).data,o=function t(e,n){if(p.default.object(n)&&p.default.object(e))for(var r in n)n[r]instanceof f.Monkey?delete e[r]:t(e[r],n[r])};return o(n,r),n}},e.prototype.project=function(t){if(p.default.object(t)){var e={};for(var n in t)e[n]=this.get(t[n]);return e}if(p.default.array(t)){for(var r=[],o=0,i=t.length;o<i;o++)r.push(this.get(t[o]));return r}throw(0,d.makeError)("Baobab.Cursor.project: wrong projection.",{projection:t})},e.prototype.startRecording=function(t){if(t=t||1/0,t<1)throw(0,d.makeError)("Baobab.Cursor.startRecording: invalid max records.",{value:t});return this.state.recording=!0,this.archive?this:(this._lazyBind(),this.archive=new d.Archive(t),this)},e.prototype.stopRecording=function(){return this.state.recording=!1,this},e.prototype.undo=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!this.state.recording)throw new Error("Baobab.Cursor.undo: cursor is not recording.");var e=this.archive.back(t);if(!e)throw Error("Baobab.Cursor.undo: cannot find a relevant record.");return this.state.undoing=!0,this.set(e),this},e.prototype.hasHistory=function(){return!(!this.archive||!this.archive.get().length)},e.prototype.getHistory=function(){return this.archive?this.archive.get():[]},e.prototype.clearHistory=function(){return this.archive&&this.archive.clear(),this},e.prototype.release=function(){this._dynamicPath&&this.tree.off("write",this._writeHandler),this.tree.off("update",this._updateHandler),this.hash&&delete this.tree._cursors[this.hash],delete this.tree,delete this.path,delete this.solvedPath,delete this.archive,this.kill(),this.state.killed=!0},e.prototype.toJSON=function(){return this.serialize()},e.prototype.toString=function(){return this._identity},e}(h.default);n.default=y,"function"==typeof Symbol&&"undefined"!=typeof Symbol.iterator&&(y.prototype[Symbol.iterator]=function(){var t=this._get().data;if(!p.default.array(t))throw Error("baobab.Cursor.@@iterate: cannot iterate a non-list type.");var e=0,n=this,r=t.length;return{next:function(){return e<r?{value:n.select(e++)}:{done:!0}}}});var v={unset:!0,pop:!0,shift:!0};u("set"),u("unset"),u("apply",p.default.function),u("push"),u("concat",p.default.array),u("unshift"),u("pop"),u("shift"),u("splice",p.default.splicer),u("merge",p.default.object),u("deepMerge",p.default.object)},{"./helpers":4,"./monkey":5,"./type":6,emmett:1}],4:[function(t,e,n){(function(e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){var n=void 0,r=void 0;for(n=0,r=t.length;n<r;n++)if(e(t[n]))return n;return-1}function a(t){var e=new Array(t.length),n=void 0,r=void 0;for(n=0,r=t.length;n<r;n++)e[n]=t[n];return e}function s(t){return a(t)}function u(t,e){return function(){t.apply(null,arguments),e.apply(null,arguments)}}function l(t){var e=t.source,n="";return t.global&&(n+="g"),t.multiline&&(n+="m"),t.ignoreCase&&(n+="i"),t.sticky&&(n+="y"),t.unicode&&(n+="u"),new RegExp(e,n)}function h(t,n){if(!n||"object"!=typeof n||n instanceof Error||n instanceof _.MonkeyDefinition||n instanceof _.Monkey||"ArrayBuffer"in e&&n instanceof ArrayBuffer)return n;if(k.default.array(n)){if(t){var r=[],o=void 0,i=void 0;for(o=0,i=n.length;o<i;o++)r.push(h(!0,n[o]));return r}return a(n)}if(n instanceof Date)return new Date(n.getTime());if(n instanceof RegExp)return l(n);if(k.default.object(n)){var s={},u=void 0;for(u in n)k.default.lazyGetter(n,u)?Object.defineProperty(s,u,{get:Object.getOwnPropertyDescriptor(n,u).get,enumerable:!0,configurable:!0}):j.call(n,u)&&(s[u]=t?h(!0,n[u]):n[u]);return s}return n}function f(t){return t||0===t||""===t?t:[]}function c(t,e){var n=!0,r=void 0;if(!t)return!1;for(r in e)if(k.default.object(e[r]))n=n&&c(t[r],e[r]);else if(k.default.array(e[r]))n=n&&!!~e[r].indexOf(t[r]);else if(t[r]!==e[r])return!1;return n}function p(t,e){if(!("object"!=typeof e||null===e||e instanceof _.Monkey)&&(Object.freeze(e),t))if(Array.isArray(e)){var n=void 0,r=void 0;for(n=0,r=e.length;n<r;n++)p(!0,e[n])}else{var o=void 0,i=void 0;for(i in e)k.default.lazyGetter(e,i)||(o=e[i],o&&j.call(e,i)&&"object"==typeof o&&!Object.isFrozen(o)&&p(!0,o))}}function d(t,e){if(!e)return B;var n=[],r=!0,o=t,a=void 0,s=void 0,u=void 0;for(s=0,u=e.length;s<u;s++){if(!o)return{data:void 0,solvedPath:n.concat(e.slice(s)),exists:!1};if("function"==typeof e[s]){if(!k.default.array(o))return B;if(a=i(o,e[s]),!~a)return B;n.push(a),o=o[a]}else if("object"==typeof e[s]){if(!k.default.array(o))return B;if(a=i(o,function(t){return c(t,e[s])}),!~a)return B;n.push(a),o=o[a]}else n.push(e[s]),r="object"==typeof o&&e[s]in o,o=o[e[s]]}return{data:o,solvedPath:n,exists:r}}function y(t,e){var n=new Error(t);for(var r in e)n[r]=e[r];return n}function v(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o=n[0],i=void 0,a=void 0,s=void 0,u=void 0;for(a=1,s=n.length;a<s;a++){i=n[a];for(u in i)!t||!k.default.object(i[u])||i[u]instanceof _.Monkey?o[u]=i[u]:o[u]=v(!0,o[u]||{},i[u])}return o}function m(t,e){var n=[];e=[].concat(e);for(var r=0,o=e.length;r<o;r++){var i=e[r];"."===i?r||(n=t.slice(0)):".."===i?n=(r?n:t).slice(0,-1):n.push(i)}return n}function g(t,e){var n=void 0,r=void 0,o=void 0,i=void 0,a=void 0,s=void 0,u=void 0,l=void 0,h=void 0;for(n=0,i=t.length;n<i;n++){if(u=t[n],!u.length)return!0;for(r=0,a=e.length;r<a;r++){if(l=e[r],!l||!l.length)return!0;for(o=0,s=l.length;o<s&&(h=l[o],h==u[o]);o++)if(o+1===s||o+1===u.length)return!0}}return!1}function b(t,e,n){n=Math.max(0,n),k.default.function(e)&&(e=i(t,e)),k.default.object(e)&&(e=i(t,function(t){return c(t,e)}));for(var r=arguments.length,o=Array(r>3?r-3:0),a=3;a<r;a++)o[a-3]=arguments[a];return e>=0?t.slice(0,e).concat(o).concat(t.slice(e+n)):t.slice(0,t.length+e).concat(o).concat(t.slice(t.length+e+n))}n.__esModule=!0,n.uniqid=n.deepMerge=n.shallowMerge=n.deepFreeze=n.freeze=n.deepClone=n.shallowClone=n.Archive=void 0,n.arrayFrom=s,n.before=u,n.coercePath=f,n.getIn=d,n.makeError=y,n.solveRelativePath=m,n.solveUpdate=g,n.splice=b;var _=t("./monkey"),w=t("./type"),k=r(w),P=Function.prototype,j={}.hasOwnProperty,M=(n.Archive=function(){function t(e){o(this,t),this.size=e,this.records=[]}return t.prototype.get=function(){return this.records},t.prototype.add=function(t){return this.records.unshift(t),this.records.length>this.size&&(this.records.length=this.size),this},t.prototype.clear=function(){return this.records=[],this},t.prototype.back=function(t){var e=this.records[t-1];return e&&(this.records=this.records.slice(t)),e},t}(),h.bind(null,!1)),C=h.bind(null,!0);n.shallowClone=M,n.deepClone=C;var E="function"==typeof Object.freeze,O=E?p.bind(null,!1):P,x=E?p.bind(null,!0):P;n.freeze=O,n.deepFreeze=x;var B={data:void 0,solvedPath:null,exists:!1},z=v.bind(null,!1),D=v.bind(null,!0);n.shallowMerge=z,n.deepMerge=D;var A=function(){var t=0;return function(){return t++}}();n.uniqid=A}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./monkey":5,"./type":6}],5:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.__esModule=!0,n.Monkey=n.MonkeyDefinition=void 0;var i=t("./type"),a=r(i),s=t("./update"),u=r(s),l=t("./helpers");n.MonkeyDefinition=function t(e){var n=this;o(this,t);var r=a.default.monkeyDefinition(e);if(!r)throw(0,l.makeError)("Baobab.monkey: invalid definition.",{definition:e});if(this.type=r,"object"===this.type)this.getter=e.get,this.projection=e.cursors||{},this.paths=Object.keys(this.projection).map(function(t){return n.projection[t]}),this.options=e.options||{};else{var i=1,s={};a.default.object(e[e.length-1])&&(i++,s=e[e.length-1]),this.getter=e[e.length-i],this.projection=e.slice(0,-i),this.paths=this.projection,this.options=s}this.paths=this.paths.map(function(t){return[].concat(t)}),this.hasDynamicPaths=this.paths.some(a.default.dynamicPath)},n.Monkey=function(){function t(e,n,r){var i=this;o(this,t),this.tree=e,this.path=n,this.definition=r;var a=r.projection,s=l.solveRelativePath.bind(null,n.slice(0,-1));"object"===r.type?(this.projection=Object.keys(a).reduce(function(t,e){return t[e]=s(a[e]),t},{}),this.depPaths=Object.keys(this.projection).map(function(t){return i.projection[t]})):(this.projection=a.map(s),this.depPaths=this.projection),this.state={killed:!1},this.writeListener=function(t){var e=t.data.path;if(!i.state.killed){var n=(0,l.solveUpdate)([e],i.relatedPaths());n&&i.update()}},this.recursiveListener=function(t){var e=t.data,n=e.monkey,r=e.path;if(!i.state.killed&&i!==n){var o=(0,l.solveUpdate)([r],i.relatedPaths(!1));o&&i.update()}},this.tree.on("write",this.writeListener),this.tree.on("_monkey",this.recursiveListener),this.update()}return t.prototype.relatedPaths=function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=void 0;n=this.definition.hasDynamicPaths?this.depPaths.map(function(e){return(0,l.getIn)(t.tree._data,e).solvedPath}):this.depPaths;var r=e&&this.depPaths.some(function(e){return!!a.default.monkeyPath(t.tree._monkeys,e)});return r?n.reduce(function(e,n){var r=a.default.monkeyPath(t.tree._monkeys,n);if(!r)return e.concat([n]);var o=(0,l.getIn)(t.tree._monkeys,r).data;return e.concat(o.relatedPaths())},[]):n},t.prototype.update=function(){var t=this.tree.project(this.projection),e=function(t,e,n){var r=null,o=!1;return function(){return o||(r=e.getter.apply(t,"object"===e.type?[n]:n),t.options.immutable&&e.options.immutable!==!1&&(0,l.deepFreeze)(r),o=!0),r}}(this.tree,this.definition,t);if(e.isLazyGetter=!0,this.tree.options.lazyMonkeys)this.tree._data=(0,u.default)(this.tree._data,this.path,{type:"monkey",value:e},this.tree.options).data;else{var n=(0,u.default)(this.tree._data,this.path,{type:"set",value:e(),options:{mutableLeaf:!this.definition.options.immutable}},this.tree.options);"data"in n&&(this.tree._data=n.data)}return this.tree.emit("_monkey",{monkey:this,path:this.path}),this},t.prototype.release=function(){this.tree.off("write",this.writeListener),this.tree.off("_monkey",this.monkeyListener),this.state.killed=!0,delete this.projection,delete this.depPaths,delete this.tree},t}()},{"./helpers":4,"./type":6,"./update":7}],6:[function(t,e,n){"use strict";function r(t,e){return e.some(function(e){return i[e](t)})}n.__esModule=!0;var o=t("./monkey"),i={};i.array=function(t){return Array.isArray(t)},i.object=function(t){return t&&"object"==typeof t&&!Array.isArray(t)&&!(t instanceof Date)&&!(t instanceof RegExp)&&!("function"==typeof Map&&t instanceof Map)&&!("function"==typeof Set&&t instanceof Set)},i.string=function(t){return"string"==typeof t},i.number=function(t){return"number"==typeof t},i.function=function(t){return"function"==typeof t},i.primitive=function(t){return t!==Object(t)},i.splicer=function(t){return!(!i.array(t)||t.length<2)&&(r(t[0],["number","function","object"])&&i.number(t[1]))};var a=["string","number","function","object"];i.path=function(t){return!(!t&&0!==t&&""!==t)&&[].concat(t).every(function(t){return r(t,a)})},i.dynamicPath=function(t){return t.some(function(t){return i.function(t)||i.object(t)})},i.monkeyPath=function(t,e){var n=[],r=t,i=void 0,a=void 0;for(i=0,a=e.length;i<a;i++){if(n.push(e[i]),"object"!=typeof r)return null;if(r=r[e[i]],r instanceof o.Monkey)return n}return null},i.lazyGetter=function(t,e){var n=Object.getOwnPropertyDescriptor(t,e);return n&&n.get&&n.get.isLazyGetter===!0},i.monkeyDefinition=function(t){if(i.object(t))return i.function(t.get)&&(!t.cursors||i.object(t.cursors)&&Object.keys(t.cursors).every(function(e){return i.path(t.cursors[e])}))?"object":null;if(i.array(t)){var e=1;return i.object(t[t.length-1])&&e++,i.function(t[t.length-e])&&t.slice(0,-e).every(function(t){return i.path(t)})?"array":null}return null},i.watcherMapping=function(t){return i.object(t)&&Object.keys(t).every(function(e){return i.path(t[e])})};var s=["set","apply","push","unshift","concat","pop","shift","deepMerge","merge","splice","unset"];i.operationType=function(t){return"string"==typeof t&&!!~s.indexOf(t)},n.default=i},{"./monkey":5}],7:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e,n){return(0,u.makeError)('Baobab.update: cannot apply the "'+t+'" on '+("a non "+e+" (path: /"+n.join("/")+")."),{path:n})}function i(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=n.type,a=n.value,l=n.options,h=void 0===l?{}:l,f={root:t},c=["root"].concat(e),p=[],d=f,y=void 0,v=void 0,m=void 0;for(y=0,v=c.length;y<v;y++){if(m=c[y],y>0&&p.push(m),y===v-1){if("set"===i){if(r.pure&&d[m]===a)return{node:d[m]};s.default.lazyGetter(d,m)?Object.defineProperty(d,m,{value:a,enumerable:!0,configurable:!0}):r.persistent&&!h.mutableLeaf?d[m]=(0,u.shallowClone)(a):d[m]=a}else if("monkey"===i)Object.defineProperty(d,m,{get:a,enumerable:!0,configurable:!0});else if("apply"===i){var g=a(d[m]);if(r.pure&&d[m]===g)return{node:d[m]};s.default.lazyGetter(d,m)?Object.defineProperty(d,m,{value:g,enumerable:!0,configurable:!0}):r.persistent?d[m]=(0,u.shallowClone)(g):d[m]=g}else if("push"===i){if(!s.default.array(d[m]))throw o("push","array",p);r.persistent?d[m]=d[m].concat([a]):d[m].push(a)}else if("unshift"===i){if(!s.default.array(d[m]))throw o("unshift","array",p);r.persistent?d[m]=[a].concat(d[m]):d[m].unshift(a)}else if("concat"===i){if(!s.default.array(d[m]))throw o("concat","array",p);r.persistent?d[m]=d[m].concat(a):d[m].push.apply(d[m],a)}else if("splice"===i){if(!s.default.array(d[m]))throw o("splice","array",p);r.persistent?d[m]=u.splice.apply(null,[d[m]].concat(a)):d[m].splice.apply(d[m],a)}else if("pop"===i){if(!s.default.array(d[m]))throw o("pop","array",p);r.persistent?d[m]=(0,u.splice)(d[m],-1,1):d[m].pop()}else if("shift"===i){if(!s.default.array(d[m]))throw o("shift","array",p);r.persistent?d[m]=(0,u.splice)(d[m],0,1):d[m].shift()}else if("unset"===i)s.default.object(d)?delete d[m]:s.default.array(d)&&d.splice(m,1);else if("merge"===i){if(!s.default.object(d[m]))throw o("merge","object",p);r.persistent?d[m]=(0,u.shallowMerge)({},d[m],a):d[m]=(0,u.shallowMerge)(d[m],a)}else if("deepMerge"===i){if(!s.default.object(d[m]))throw o("deepMerge","object",p);r.persistent?d[m]=(0,u.deepMerge)({},d[m],a):d[m]=(0,u.deepMerge)(d[m],a)}r.immutable&&!h.mutableLeaf&&(0,u.deepFreeze)(d);break}s.default.primitive(d[m])?d[m]={}:r.persistent&&(d[m]=(0,u.shallowClone)(d[m])),r.immutable&&v>0&&(0,u.freeze)(d),d=d[m]}return s.default.lazyGetter(d,m)?{data:f.root}:{data:f.root,node:d[m]}}n.__esModule=!0,n.default=i;var a=t("./type"),s=r(a),u=t("./helpers")},{"./helpers":4,"./type":6}],8:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);
t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}n.__esModule=!0;var s=t("emmett"),u=r(s),l=t("./cursor"),h=r(l),f=t("./type"),c=r(f),p=t("./helpers"),d=function(t){function e(n,r){o(this,e);var a=i(this,t.call(this));return a.tree=n,a.mapping=null,a.state={killed:!1},a.refresh(r),a.handler=function(t){if(!a.state.killed){var e=a.getWatchedPaths();return(0,p.solveUpdate)(t.data.paths,e)?a.emit("update",t):void 0}},a.tree.on("update",a.handler),a}return a(e,t),e.prototype.getWatchedPaths=function(){var t=this,e=Object.keys(this.mapping).map(function(e){var n=t.mapping[e];return n instanceof h.default?n.solvedPath:t.mapping[e]});return e.reduce(function(e,n){if(n=[].concat(n),c.default.dynamicPath(n)&&(n=(0,p.getIn)(t.tree._data,n).solvedPath),!n)return e;var r=c.default.monkeyPath(t.tree._monkeys,n);return r?e.concat((0,p.getIn)(t.tree._monkeys,r).data.relatedPaths()):e.concat([n])},[])},e.prototype.getCursors=function(){var t=this,e={};return Object.keys(this.mapping).forEach(function(n){var r=t.mapping[n];r instanceof h.default?e[n]=r:e[n]=t.tree.select(r)}),e},e.prototype.refresh=function(t){if(!c.default.watcherMapping(t))throw(0,p.makeError)("Baobab.watch: invalid mapping.",{mapping:t});this.mapping=t;var e={};for(var n in t)e[n]=t[n]instanceof h.default?t[n].path:t[n];this.get=this.tree.project.bind(this.tree,e)},e.prototype.release=function(){this.tree.off("update",this.handler),this.state.killed=!0,this.kill()},e}(u.default);n.default=d},{"./cursor":3,"./helpers":4,"./type":6,emmett:1}]},{},[2])(2)});
=======
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Baobab=t()}}(function(){var t;return function t(e,r,n){function i(a,s){if(!r[a]){if(!e[a]){var h="function"==typeof require&&require;if(!s&&h)return h(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[a]={exports:{}};e[a][0].call(l.exports,function(t){var r=e[a][1][t];return i(r?r:t)},l,l.exports,t,e,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,r,n){(function(){"use strict";function e(t,e){var r,n={};for(r in t)n[r]=t[r];for(r in e)n[r]=e[r];return n}function i(t){return t&&"object"==typeof t&&!Array.isArray(t)&&!(t instanceof Function)&&!(t instanceof RegExp)}function o(t,e,r){var n,i,o,a;for(i in t)e.call(r||null,i,t[i]);if(Object.getOwnPropertySymbols)for(n=Object.getOwnPropertySymbols(t),o=0,a=n.length;o<a;o++)e.call(r||null,n[o],t[n[o]])}function a(t,e){t=t||[];var r,n,i=[];for(n=0,r=t.length;n<r;n++)t[n].fn!==e&&i.push(t[n]);return i}var s={once:"boolean",scope:"object"},h=0,u=function(){this._enabled=!0,this.unbindAll()};u.prototype.unbindAll=function(){return this._handlers={},this._handlersAll=[],this._handlersComplex=[],this},u.prototype.on=function(t,e,r){var n,a,u,l,f,c,p;if(i(t))return o(t,function(t,r){this.on(t,r,e)},this),this;for("function"==typeof t&&(r=e,e=t,t=null),f=[].concat(t),n=0,a=f.length;n<a;n++){if(l=f[n],p={order:h++,fn:e},"string"==typeof l||"symbol"==typeof l)this._handlers[l]||(this._handlers[l]=[]),c=this._handlers[l],p.type=l;else if(l instanceof RegExp)c=this._handlersComplex,p.pattern=l;else{if(null!==l)throw Error("Emitter.on: invalid event.");c=this._handlersAll}for(u in r||{})s[u]&&(p[u]=r[u]);c.push(p)}return this},u.prototype.once=function(){var t=Array.prototype.slice.call(arguments),r=t.length-1;return i(t[r])&&t.length>1?t[r]=e(t[r],{once:!0}):t.push({once:!0}),this.on.apply(this,t)},u.prototype.off=function(t,e){var r,n,s,h;if(1===arguments.length&&"function"==typeof t){e=arguments[0];for(s in this._handlers)this._handlers[s]=a(this._handlers[s],e),0===this._handlers[s].length&&delete this._handlers[s];this._handlersAll=a(this._handlersAll,e),this._handlersComplex=a(this._handlersComplex,e)}else if(1!==arguments.length||"string"!=typeof t&&"symbol"!=typeof t)if(2===arguments.length){var u=[].concat(t);for(r=0,n=u.length;r<n;r++)h=u[r],this._handlers[h]=a(this._handlers[h],e),0===(this._handlers[h]||[]).length&&delete this._handlers[h]}else i(t)&&o(t,this.off,this);else delete this._handlers[t];return this},u.prototype.listeners=function(t){var e,r,n,i=this._handlersAll||[],o=!1;if(!t)throw Error("Emitter.listeners: no event provided.");for(i=i.concat(this._handlers[t]||[]),r=0,n=this._handlersComplex.length;r<n;r++)e=this._handlersComplex[r],~t.search(e.pattern)&&(o=!0,i.push(e));return this._handlersAll.length||o?i.sort(function(t,e){return t.order-e.order}):i.slice(0)},u.prototype.emit=function(t,e){if(!this._enabled)return this;if(i(t))return o(t,this.emit,this),this;var r,n,a,s,h,u,l,f,c=[].concat(t),p=[];for(h=0,l=c.length;h<l;h++){for(a=this.listeners(c[h]),u=0,f=a.length;u<f;u++)s=a[u],r={type:c[h],target:this},arguments.length>1&&(r.data=e),s.fn.call("scope"in s?s.scope:this,r),s.once&&p.push(s);for(u=p.length-1;u>=0;u--)n=p[u].type?this._handlers[p[u].type]:p[u].pattern?this._handlersComplex:this._handlersAll,n.splice(n.indexOf(p[u]),1)}return this},u.prototype.kill=function(){this.unbindAll(),this._handlers=null,this._handlersAll=null,this._handlersComplex=null,this._enabled=!1,this.unbindAll=this.on=this.once=this.off=this.emit=this.listeners=Function.prototype},u.prototype.disable=function(){return this._enabled=!1,this},u.prototype.enable=function(){return this._enabled=!0,this},u.version="3.1.1",void 0!==n?(void 0!==r&&r.exports&&(n=r.exports=u),n.Emitter=u):"function"==typeof t&&t.amd?t("emmett",[],function(){return u}):this.Emitter=u}).call(this)},{}],2:[function(t,e,r){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){return"λ"+t.map(function(t){return v.default.function(t)||v.default.object(t)?"#"+B()+"#":t}).join("λ")}r.__esModule=!0;var h=t("emmett"),u=i(h),l=t("./cursor"),f=i(l),c=t("./monkey"),p=t("./watcher"),d=i(p),y=t("./type"),v=i(y),g=t("./update"),m=i(g),b=t("./helpers"),_=n(b),w=_.arrayFrom,k=_.coercePath,P=_.deepFreeze,j=_.getIn,M=_.makeError,O=_.deepClone,C=_.deepMerge,E=_.shallowClone,x=_.shallowMerge,B=_.uniqid,D={autoCommit:!0,asynchronous:!0,immutable:!0,lazyMonkeys:!0,persistent:!0,pure:!0,validate:null,validationBehavior:"rollback"},z=function(t){function e(r,n){var i=this;if(o(this,e),t.call(this),arguments.length<1&&(r={}),!v.default.object(r)&&!v.default.array(r))throw M("Baobab: invalid data.",{data:r});this.options=x({},D,n),this.options.persistent||(this.options.immutable=!1,this.options.pure=!1),this._identity="[object Baobab]",this._cursors={},this._future=null,this._transaction=[],this._affectedPathsIndex={},this._monkeys={},this._previousData=null,this._data=r,this.root=new f.default(this,[],"λ"),delete this.root.release,this.options.immutable&&P(this._data);var a=function(t){i[t]=function(){var e=this.root[t].apply(this.root,arguments);return e instanceof f.default?this:e}};["apply","clone","concat","deepClone","deepMerge","exists","get","push","merge","pop","project","serialize","set","shift","splice","unset","unshift"].forEach(a),this._refreshMonkeys();var s=this.validate();if(s)throw Error("Baobab: invalid data.",{error:s})}return a(e,t),e.prototype._refreshMonkeys=function(t,e,r){var n=this,i=function t(e){var r=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];if(e instanceof c.Monkey)return e.release(),void m.default(n._monkeys,r,{type:"unset"},{immutable:!1,persistent:!1,pure:!1});if(v.default.object(e))for(var i in e)t(e[i],r.concat(i))},o=function t(e){var r=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];if(e instanceof c.MonkeyDefinition||e instanceof c.Monkey){var i=new c.Monkey(n,r,e instanceof c.Monkey?e.definition:e);return void m.default(n._monkeys,r,{type:"set",value:i},{immutable:!1,persistent:!1,pure:!1})}if(v.default.object(e))for(var o in e)t(e[o],r.concat(o))};if(arguments.length){var a=j(this._monkeys,e).data;a&&i(a,e),"unset"!==r&&o(t,e)}else o(this._data);return this},e.prototype.validate=function t(e){var r=this.options,t=r.validate,n=r.validationBehavior;if("function"!=typeof t)return null;var i=t.call(this,this._previousData,this._data,e||[[]]);return i instanceof Error?("rollback"===n&&(this._data=this._previousData,this._affectedPathsIndex={},this._transaction=[],this._previousData=this._data),this.emit("invalid",{error:i}),i):null},e.prototype.select=function(t){if(t=t||[],arguments.length>1&&(t=w(arguments)),!v.default.path(t))throw M("Baobab.select: invalid path.",{path:t});t=[].concat(t);var e=s(t),r=this._cursors[e];return r||(r=new f.default(this,t,e),this._cursors[e]=r),this.emit("select",{path:t,cursor:r}),r},e.prototype.update=function(t,e){var r=this;if(t=k(t),!v.default.operationType(e.type))throw M('Baobab.update: unknown operation type "'+e.type+'".',{operation:e});var n=j(this._data,t),i=n.solvedPath,o=n.exists;if(!i)throw M("Baobab.update: could not solve the given path.",{path:i});var a=v.default.monkeyPath(this._monkeys,i);if(a&&i.length>a.length)throw M("Baobab.update: attempting to update a read-only path.",{path:i});if("unset"!==e.type||o){var h=e;if(/merge/i.test(e.type)){var u=j(this._monkeys,i).data;if(v.default.object(u)){h=E(h);var l=j(this._data,i).data;/deep/i.test(h.type)?h.value=C({},C({},l,O(u)),h.value):h.value=x({},C({},l,O(u)),h.value)}}this._transaction.length||(this._previousData=this._data);var f=m.default(this._data,i,h,this.options),c=f.data,p=f.node;if(!("data"in f))return p;var d=i.concat("push"===e.type?p.length-1:[]),y=s(d);return this._data=c,this._affectedPathsIndex[y]=!0,this._transaction.push(x({},e,{path:d})),this._refreshMonkeys(p,i,e.type),this.emit("write",{path:d}),this.options.autoCommit?this.options.asynchronous?(this._future||(this._future=setTimeout(function(){return r.commit()},0)),p):(this.commit(),p):p}},e.prototype.commit=function(){if(!this._transaction.length)return this;this._future&&(this._future=clearTimeout(this._future));var t=Object.keys(this._affectedPathsIndex).map(function(t){return"λ"!==t?t.split("λ").slice(1):[]});if(this.validate(t))return this;var e=this._transaction,r=this._previousData;return this._affectedPathsIndex={},this._transaction=[],this._previousData=this._data,this.emit("update",{paths:t,currentData:this._data,transaction:e,previousData:r}),this},e.prototype.getMonkey=function(t){t=k(t);var e=j(this._monkeys,[].concat(t)).data;return e instanceof c.Monkey?e:null},e.prototype.watch=function(t){return new d.default(this,t)},e.prototype.release=function(){var t=void 0;this.emit("release"),delete this.root,delete this._data,delete this._previousData,delete this._transaction,delete this._affectedPathsIndex,delete this._monkeys;for(t in this._cursors)this._cursors[t].release();delete this._cursors,this.kill()},e.prototype.toJSON=function(){return this.serialize()},e.prototype.toString=function(){return this._identity},e}(u.default);r.default=z,z.monkey=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];if(!e.length)throw new Error("Baobab.monkey: missing definition.");return 1===e.length&&"function"!=typeof e[0]?new c.MonkeyDefinition(e[0]):new c.MonkeyDefinition(e)},z.dynamicNode=z.monkey,z.Cursor=f.default,z.MonkeyDefinition=c.MonkeyDefinition,z.Monkey=c.Monkey,z.type=v.default,z.helpers=_,z.VERSION="2.4.3",e.exports=r.default},{"./cursor":3,"./helpers":4,"./monkey":5,"./type":6,"./update":7,"./watcher":8,emmett:1}],3:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){if(!e)throw p.makeError("Baobab.Cursor."+t+": cannot use "+t+" on an unresolved dynamic path.",{path:e})}function s(t,e){d.prototype[t]=function(r,n){if(arguments.length>2)throw p.makeError("Baobab.Cursor."+t+": too many arguments.");if(1!==arguments.length||y[t]||(n=r,r=[]),r=p.coercePath(r),!c.default.path(r))throw p.makeError("Baobab.Cursor."+t+": invalid path.",{path:r});if(e&&!e(n))throw p.makeError("Baobab.Cursor."+t+": invalid value.",{path:r,value:n});if(!this.solvedPath)throw p.makeError("Baobab.Cursor."+t+": the dynamic path of the cursor cannot be solved.",{path:this.path});var i=this.solvedPath.concat(r);return this.tree.update(i,{type:t,value:n})}}r.__esModule=!0;var h=t("emmett"),u=n(h),l=t("./monkey"),f=t("./type"),c=n(f),p=t("./helpers"),d=function(t){function e(r,n,o){var a=this;i(this,e),t.call(this),n=n||[],this._identity="[object Cursor]",this._archive=null,this.tree=r,this.path=n,this.hash=o,this.state={killed:!1,recording:!1,undoing:!1},this._dynamicPath=c.default.dynamicPath(this.path),this._monkeyPath=c.default.monkeyPath(this.tree._monkeys,this.path),this._dynamicPath?this.solvedPath=p.getIn(this.tree._data,this.path).solvedPath:this.solvedPath=this.path,this._writeHandler=function(t){var e=t.data;!a.state.killed&&p.solveUpdate([e.path],a._getComparedPaths())&&(a.solvedPath=p.getIn(a.tree._data,a.path).solvedPath)};var s=function(t){var e=a,r=Object.defineProperties({},{previousData:{get:function(){return p.getIn(t,e.solvedPath).data},configurable:!0,enumerable:!0},currentData:{get:function(){return e.get()},configurable:!0,enumerable:!0}});return a.state.recording&&!a.state.undoing&&a.archive.add(r.previousData),a.state.undoing=!1,a.emit("update",r)};this._updateHandler=function(t){if(!a.state.killed){var e=t.data,r=e.paths,n=e.previousData,i=s.bind(a,n),o=a._getComparedPaths();return p.solveUpdate(r,o)?i():void 0}};var h=!1;this._lazyBind=function(){if(!h)return h=!0,a._dynamicPath&&a.tree.on("write",a._writeHandler),a.tree.on("update",a._updateHandler)},this._dynamicPath?this._lazyBind():(this.on=p.before(this._lazyBind,this.on.bind(this)),this.once=p.before(this._lazyBind,this.once.bind(this)))}return o(e,t),e.prototype._getComparedPaths=function(){var t=this._monkeyPath?p.getIn(this.tree._monkeys,this._monkeyPath).data.relatedPaths():[];return[this.solvedPath].concat(t)},e.prototype.isRoot=function(){return!this.path.length},e.prototype.isLeaf=function(){return c.default.primitive(this._get().data)},e.prototype.isBranch=function(){return!this.isRoot()&&!this.isLeaf()},e.prototype.root=function(){return this.tree.select()},e.prototype.select=function(t){return arguments.length>1&&(t=p.arrayFrom(arguments)),this.tree.select(this.path.concat(t))},e.prototype.up=function(){return this.isRoot()?null:this.tree.select(this.path.slice(0,-1))},e.prototype.down=function(){if(a("down",this.solvedPath),!(this._get().data instanceof Array))throw Error("Baobab.Cursor.down: cannot go down on a non-list type.");return this.tree.select(this.solvedPath.concat(0))},e.prototype.left=function(){a("left",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.left: cannot go left on a non-list type.");return t?this.tree.select(this.solvedPath.slice(0,-1).concat(t-1)):null},e.prototype.right=function(){a("right",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.right: cannot go right on a non-list type.");return t+1===this.up()._get().data.length?null:this.tree.select(this.solvedPath.slice(0,-1).concat(t+1))},e.prototype.leftmost=function(){a("leftmost",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.leftmost: cannot go left on a non-list type.");return this.tree.select(this.solvedPath.slice(0,-1).concat(0))},e.prototype.rightmost=function(){a("rightmost",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.rightmost: cannot go right on a non-list type.");var e=this.up()._get().data;return this.tree.select(this.solvedPath.slice(0,-1).concat(e.length-1))},e.prototype.map=function(t,e){a("map",this.solvedPath);var r=this._get().data,n=arguments.length;if(!c.default.array(r))throw Error("baobab.Cursor.map: cannot map a non-list type.");return r.map(function(i,o){return t.call(n>1?e:this,this.select(o),o,r)},this)},e.prototype._get=function(){var t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];if(!c.default.path(t))throw p.makeError("Baobab.Cursor.getters: invalid path.",{path:t});return this.solvedPath?p.getIn(this.tree._data,this.solvedPath.concat(t)):{data:void 0,solvedPath:null,exists:!1}},e.prototype.exists=function(t){return t=p.coercePath(t),arguments.length>1&&(t=p.arrayFrom(arguments)),this._get(t).exists},e.prototype.get=function(t){t=p.coercePath(t),arguments.length>1&&(t=p.arrayFrom(arguments));var e=this._get(t),r=e.data,n=e.solvedPath;return this.tree.emit("get",{data:r,solvedPath:n,path:this.path.concat(t)}),r},e.prototype.clone=function(){var t=this.get.apply(this,arguments);return p.shallowClone(t)},e.prototype.deepClone=function(){var t=this.get.apply(this,arguments);return p.deepClone(t)},e.prototype.serialize=function(t){if(t=p.coercePath(t),arguments.length>1&&(t=p.arrayFrom(arguments)),!c.default.path(t))throw p.makeError("Baobab.Cursor.getters: invalid path.",{path:t});if(this.solvedPath){var e=this.solvedPath.concat(t),r=p.deepClone(p.getIn(this.tree._data,e).data),n=p.getIn(this.tree._monkeys,e).data;return function t(e,r){if(c.default.object(r)&&c.default.object(e))for(var n in r)r[n]instanceof l.Monkey?delete e[n]:t(e[n],r[n])}(r,n),r}},e.prototype.project=function(t){if(c.default.object(t)){var e={};for(var r in t)e[r]=this.get(t[r]);return e}if(c.default.array(t)){for(var e=[],n=0,i=t.length;n<i;n++)e.push(this.get(t[n]));return e}throw p.makeError("Baobab.Cursor.project: wrong projection.",{projection:t})},e.prototype.startRecording=function(t){if(t=t||1/0,t<1)throw p.makeError("Baobab.Cursor.startRecording: invalid max records.",{value:t});return this.state.recording=!0,this.archive?this:(this._lazyBind(),this.archive=new p.Archive(t),this)},e.prototype.stopRecording=function(){return this.state.recording=!1,this},e.prototype.undo=function(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0];if(!this.state.recording)throw new Error("Baobab.Cursor.undo: cursor is not recording.");var e=this.archive.back(t);if(!e)throw Error("Baobab.Cursor.undo: cannot find a relevant record.");return this.state.undoing=!0,this.set(e),this},e.prototype.hasHistory=function(){return!(!this.archive||!this.archive.get().length)},e.prototype.getHistory=function(){return this.archive?this.archive.get():[]},e.prototype.clearHistory=function(){return this.archive&&this.archive.clear(),this},e.prototype.release=function(){this._dynamicPath&&this.tree.off("write",this._writeHandler),this.tree.off("update",this._updateHandler),this.hash&&delete this.tree._cursors[this.hash],delete this.tree,delete this.path,delete this.solvedPath,delete this.archive,this.kill(),this.state.killed=!0},e.prototype.toJSON=function(){return this.serialize()},e.prototype.toString=function(){return this._identity},e}(u.default);r.default=d,"function"==typeof Symbol&&void 0!==Symbol.iterator&&(d.prototype[Symbol.iterator]=function(){var t=this._get().data;if(!c.default.array(t))throw Error("baobab.Cursor.@@iterate: cannot iterate a non-list type.");var e=0,r=this,n=t.length;return{next:function(){return e<n?{value:r.select(e++)}:{done:!0}}}});var y={unset:!0,pop:!0,shift:!0};s("set"),s("unset"),s("apply",c.default.function),s("push"),s("concat",c.default.array),s("unshift"),s("pop"),s("shift"),s("splice",c.default.splicer),s("merge",c.default.object),s("deepMerge",c.default.object),e.exports=r.default},{"./helpers":4,"./monkey":5,"./type":6,emmett:1}],4:[function(t,e,r){(function(e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){var r=void 0,n=void 0;for(r=0,n=t.length;r<n;r++)if(e(t[r]))return r;return-1}function a(t){var e=new Array(t.length),r=void 0,n=void 0;for(r=0,n=t.length;r<n;r++)e[r]=t[r];return e}function s(t){return a(t)}function h(t,e){return function(){t.apply(null,arguments),e.apply(null,arguments)}}function u(t){var e=t.source,r="";return t.global&&(r+="g"),t.multiline&&(r+="m"),t.ignoreCase&&(r+="i"),t.sticky&&(r+="y"),t.unicode&&(r+="u"),new RegExp(e,r)}function l(t,r){if(!r||"object"!=typeof r||r instanceof Error||r instanceof _.MonkeyDefinition||r instanceof _.Monkey||"ArrayBuffer"in e&&r instanceof ArrayBuffer)return r;if(k.default.array(r)){if(t){var n=[],i=void 0,o=void 0;for(i=0,o=r.length;i<o;i++)n.push(l(!0,r[i]));return n}return a(r)}if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp)return u(r);if(k.default.object(r)){var s={},i=void 0,o=void 0,h=void 0,f=Object.getOwnPropertyNames(r);for(i=0,o=f.length;i<o;i++)h=f[i],k.default.lazyGetter(r,h)?Object.defineProperty(s,h,{get:Object.getOwnPropertyDescriptor(r,h).get,enumerable:!0,configurable:!0}):Object.defineProperty(s,h,{value:t?l(!0,r[h]):r[h],enumerable:Object.getOwnPropertyDescriptor(r,h).enumerable,writable:!0,configurable:!0});return s}return r}function f(t){return t||0===t||""===t?t:[]}function c(t,e){var r=!0,n=void 0;if(!t)return!1;for(n in e)if(k.default.object(e[n]))r=r&&c(t[n],e[n]);else if(k.default.array(e[n]))r=r&&!!~e[n].indexOf(t[n]);else if(t[n]!==e[n])return!1;return r}function p(t,e){if(!("object"!=typeof e||null===e||e instanceof _.Monkey)&&(Object.freeze(e),t))if(Array.isArray(e)){var r=void 0,n=void 0;for(r=0,n=e.length;r<n;r++)p(!0,e[r])}else{var i=void 0,o=void 0;for(o in e)k.default.lazyGetter(e,o)||(i=e[o],i&&j.call(e,o)&&"object"==typeof i&&!Object.isFrozen(i)&&p(!0,i))}}function d(t,e){if(!e)return D;var r=[],n=!0,i=t,a=void 0,s=void 0,h=void 0;for(s=0,h=e.length;s<h;s++){if(!i)return{data:void 0,solvedPath:r.concat(e.slice(s)),exists:!1};if("function"==typeof e[s]){if(!k.default.array(i))return D;if(a=o(i,e[s]),!~a)return D;r.push(a),i=i[a]}else if("object"==typeof e[s]){if(!k.default.array(i))return D;if(a=o(i,function(t){return c(t,e[s])}),!~a)return D;r.push(a),i=i[a]}else r.push(e[s]),n="object"==typeof i&&e[s]in i,i=i[e[s]]}return{data:i,solvedPath:r,exists:n}}function y(t,e){var r=new Error(t);for(var n in e)r[n]=e[n];return r}function v(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];var i=r[0],o=void 0,a=void 0,s=void 0,h=void 0;for(a=1,s=r.length;a<s;a++){o=r[a];for(h in o)!t||!k.default.object(o[h])||o[h]instanceof _.Monkey?i[h]=o[h]:i[h]=v(!0,i[h]||{},o[h])}return i}function g(t,e){var r=[];e=[].concat(e);for(var n=0,i=e.length;n<i;n++){var o=e[n];"."===o?n||(r=t.slice(0)):".."===o?r=(n?r:t).slice(0,-1):r.push(o)}return r}function m(t,e){var r=void 0,n=void 0,i=void 0,o=void 0,a=void 0,s=void 0,h=void 0,u=void 0,l=void 0;for(r=0,o=t.length;r<o;r++){if(h=t[r],!h.length)return!0;for(n=0,a=e.length;n<a;n++){if(u=e[n],!u||!u.length)return!0;for(i=0,s=u.length;i<s&&(l=u[i],l==h[i]);i++)if(i+1===s||i+1===h.length)return!0}}return!1}function b(t,e,r){for(var n=arguments.length,i=Array(n>3?n-3:0),a=3;a<n;a++)i[a-3]=arguments[a];if(void 0===r&&2===arguments.length)r=t.length-e;else if(null===r||void 0===r)r=0;else if(isNaN(+r))throw new Error("argument nb "+r+" can not be parsed into a number!");return r=Math.max(0,r),k.default.function(e)&&(e=o(t,e)),k.default.object(e)&&(e=o(t,function(t){return c(t,e)})),e>=0?t.slice(0,e).concat(i).concat(t.slice(e+r)):t.slice(0,t.length+e).concat(i).concat(t.slice(t.length+e+r))}r.__esModule=!0,r.arrayFrom=s,r.before=h,r.coercePath=f,r.getIn=d,r.makeError=y,r.solveRelativePath=g,r.solveUpdate=m,r.splice=b;var _=t("./monkey"),w=t("./type"),k=n(w),P=Function.prototype,j={}.hasOwnProperty,M=function(){function t(e){i(this,t),this.size=e,this.records=[]}return t.prototype.get=function(){return this.records},t.prototype.add=function(t){return this.records.unshift(t),this.records.length>this.size&&(this.records.length=this.size),this},t.prototype.clear=function(){return this.records=[],this},t.prototype.back=function(t){var e=this.records[t-1];return e&&(this.records=this.records.slice(t)),e},t}();r.Archive=M;var O=l.bind(null,!1),C=l.bind(null,!0);r.shallowClone=O,r.deepClone=C;var E="function"==typeof Object.freeze,x=E?p.bind(null,!1):P,B=E?p.bind(null,!0):P;r.freeze=x,r.deepFreeze=B;var D={data:void 0,solvedPath:null,exists:!1},z=v.bind(null,!1),A=v.bind(null,!0);r.shallowMerge=z,r.deepMerge=A;var I=function(){var t=0;return function(){return t++}}();r.uniqid=I}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./monkey":5,"./type":6}],5:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}r.__esModule=!0;var o=t("./type"),a=n(o),s=t("./update"),h=n(s),u=t("./helpers"),l=function t(e){var r=this;i(this,t);var n=a.default.monkeyDefinition(e);if(!n)throw u.makeError("Baobab.monkey: invalid definition.",{definition:e});if(this.type=n,"object"===this.type)this.getter=e.get,this.projection=e.cursors||{},this.paths=Object.keys(this.projection).map(function(t){return r.projection[t]}),this.options=e.options||{};else{var o=1,s={};a.default.object(e[e.length-1])&&(o++,s=e[e.length-1]),this.getter=e[e.length-o],this.projection=e.slice(0,-o),this.paths=this.projection,this.options=s}this.paths=this.paths.map(function(t){return[].concat(t)}),this.hasDynamicPaths=this.paths.some(a.default.dynamicPath)};r.MonkeyDefinition=l;var f=function(){function t(e,r,n){var o=this;i(this,t),this.tree=e,this.path=r,this.definition=n;var a=n.projection,s=u.solveRelativePath.bind(null,r.slice(0,-1));"object"===n.type?(this.projection=Object.keys(a).reduce(function(t,e){return t[e]=s(a[e]),t},{}),this.depPaths=Object.keys(this.projection).map(function(t){return o.projection[t]})):(this.projection=a.map(s),this.depPaths=this.projection),this.state={killed:!1},this.writeListener=function(t){var e=t.data.path;if(!o.state.killed){u.solveUpdate([e],o.relatedPaths())&&o.update()}},this.recursiveListener=function(t){var e=t.data,r=e.monkey,n=e.path;if(!o.state.killed&&o!==r){u.solveUpdate([n],o.relatedPaths(!1))&&o.update()}},this.tree.on("write",this.writeListener),this.tree.on("_monkey",this.recursiveListener),this.update()}return t.prototype.relatedPaths=function(){var t=this,e=arguments.length<=0||void 0===arguments[0]||arguments[0],r=void 0;return r=this.definition.hasDynamicPaths?this.depPaths.map(function(e){return u.getIn(t.tree._data,e).solvedPath}):this.depPaths,e&&this.depPaths.some(function(e){return!!a.default.monkeyPath(t.tree._monkeys,e)})?r.reduce(function(e,r){var n=a.default.monkeyPath(t.tree._monkeys,r);if(!n)return e.concat([r]);var i=u.getIn(t.tree._monkeys,n).data;return e.concat(i.relatedPaths())},[]):r},t.prototype.update=function(){var t=this.tree.project(this.projection),e=function(t,e,r){var n=null,i=!1;return function(){return i||(n=e.getter.apply(t,"object"===e.type?[r]:r),t.options.immutable&&e.options.immutable!==!1&&u.deepFreeze(n),i=!0),n}}(this.tree,this.definition,t);if(e.isLazyGetter=!0,this.tree.options.lazyMonkeys)this.tree._data=h.default(this.tree._data,this.path,{type:"monkey",value:e},this.tree.options).data;else{var r=h.default(this.tree._data,this.path,{type:"set",value:e(),options:{mutableLeaf:!this.definition.options.immutable}},this.tree.options);"data"in r&&(this.tree._data=r.data)}return this.tree.emit("_monkey",{monkey:this,path:this.path}),this},t.prototype.release=function(){this.tree.off("write",this.writeListener),this.tree.off("_monkey",this.recursiveListener),this.state.killed=!0,delete this.projection,delete this.depPaths,delete this.tree},t}();r.Monkey=f},{"./helpers":4,"./type":6,"./update":7}],6:[function(t,e,r){"use strict";function n(t,e){return e.some(function(e){return o[e](t)})}r.__esModule=!0;var i=t("./monkey"),o={};o.array=function(t){return Array.isArray(t)},o.object=function(t){return t&&"object"==typeof t&&!Array.isArray(t)&&!(t instanceof Date)&&!(t instanceof RegExp)&&!("function"==typeof Map&&t instanceof Map)&&!("function"==typeof Set&&t instanceof Set)},o.string=function(t){return"string"==typeof t},o.number=function(t){return"number"==typeof t},o.function=function(t){return"function"==typeof t},o.primitive=function(t){return t!==Object(t)},o.splicer=function(t){return!(!o.array(t)||t.length<1)&&(!(t.length>1&&isNaN(+t[1]))&&n(t[0],["number","function","object"]))};var a=["string","number","function","object"];o.path=function(t){return!(!t&&0!==t&&""!==t)&&[].concat(t).every(function(t){return n(t,a)})},o.dynamicPath=function(t){return t.some(function(t){return o.function(t)||o.object(t)})},o.monkeyPath=function(t,e){var r=[],n=t,o=void 0,a=void 0;for(o=0,a=e.length;o<a;o++){if(r.push(e[o]),"object"!=typeof n)return null;if(n=n[e[o]],n instanceof i.Monkey)return r}return null},o.lazyGetter=function(t,e){var r=Object.getOwnPropertyDescriptor(t,e);return r&&r.get&&r.get.isLazyGetter===!0},o.monkeyDefinition=function(t){if(o.object(t))return o.function(t.get)&&(!t.cursors||o.object(t.cursors)&&Object.keys(t.cursors).every(function(e){return o.path(t.cursors[e])}))?"object":null;if(o.array(t)){var e=1;return o.object(t[t.length-1])&&e++,o.function(t[t.length-e])&&t.slice(0,-e).every(function(t){return o.path(t)})?"array":null}return null},o.watcherMapping=function(t){return o.object(t)&&Object.keys(t).every(function(e){return o.path(t[e])})};var s=["set","apply","push","unshift","concat","pop","shift","deepMerge","merge","splice","unset"];o.operationType=function(t){return"string"==typeof t&&!!~s.indexOf(t)},r.default=o,e.exports=r.default},{"./monkey":5}],7:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e,r){return h.makeError('Baobab.update: cannot apply the "'+t+'" on a non '+e+" (path: /"+r.join("/")+").",{path:r})}function o(t,e,r){var n=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],o=r.type,a=r.value,u=r.options,l=void 0===u?{}:u,f={root:t},c=["root"].concat(e),p=[],d=f,y=void 0,v=void 0,g=void 0;for(y=0,v=c.length;y<v;y++){if(g=c[y],y>0&&p.push(g),y===v-1){if("set"===o){if(n.pure&&d[g]===a)return{node:d[g]};s.default.lazyGetter(d,g)?Object.defineProperty(d,g,{value:a,enumerable:!0,configurable:!0}):n.persistent&&!l.mutableLeaf?d[g]=h.shallowClone(a):d[g]=a}else if("monkey"===o)Object.defineProperty(d,g,{get:a,enumerable:!0,configurable:!0});else if("apply"===o){var m=a(d[g]);if(n.pure&&d[g]===m)return{node:d[g]};s.default.lazyGetter(d,g)?Object.defineProperty(d,g,{value:m,enumerable:!0,configurable:!0}):n.persistent?d[g]=h.shallowClone(m):d[g]=m}else if("push"===o){if(!s.default.array(d[g]))throw i("push","array",p);n.persistent?d[g]=d[g].concat([a]):d[g].push(a)}else if("unshift"===o){if(!s.default.array(d[g]))throw i("unshift","array",p);n.persistent?d[g]=[a].concat(d[g]):d[g].unshift(a)}else if("concat"===o){if(!s.default.array(d[g]))throw i("concat","array",p);n.persistent?d[g]=d[g].concat(a):d[g].push.apply(d[g],a)}else if("splice"===o){if(!s.default.array(d[g]))throw i("splice","array",p);n.persistent?d[g]=h.splice.apply(null,[d[g]].concat(a)):d[g].splice.apply(d[g],a)}else if("pop"===o){if(!s.default.array(d[g]))throw i("pop","array",p);n.persistent?d[g]=h.splice(d[g],-1,1):d[g].pop()}else if("shift"===o){if(!s.default.array(d[g]))throw i("shift","array",p);n.persistent?d[g]=h.splice(d[g],0,1):d[g].shift()}else if("unset"===o)s.default.object(d)?delete d[g]:s.default.array(d)&&d.splice(g,1);else if("merge"===o){if(!s.default.object(d[g]))throw i("merge","object",p);n.persistent?d[g]=h.shallowMerge({},d[g],a):d[g]=h.shallowMerge(d[g],a)}else if("deepMerge"===o){if(!s.default.object(d[g]))throw i("deepMerge","object",p);n.persistent?d[g]=h.deepMerge({},d[g],a):d[g]=h.deepMerge(d[g],a)}n.immutable&&!l.mutableLeaf&&h.deepFreeze(d);break}s.default.primitive(d[g])?d[g]={}:n.persistent&&(d[g]=h.shallowClone(d[g])),n.immutable&&v>0&&h.freeze(d),d=d[g]}return s.default.lazyGetter(d,g)?{data:f.root}:{data:f.root,node:d[g]}}r.__esModule=!0,r.default=o;var a=t("./type"),s=n(a),h=t("./helpers");e.exports=r.default},{"./helpers":4,"./type":6}],8:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}
r.__esModule=!0;var a=t("emmett"),s=n(a),h=t("./cursor"),u=n(h),l=t("./type"),f=n(l),c=t("./helpers"),p=function(t){function e(r,n){var o=this;i(this,e),t.call(this),this.tree=r,this.mapping=null,this.state={killed:!1},this.refresh(n),this.handler=function(t){if(!o.state.killed){var e=o.getWatchedPaths();return c.solveUpdate(t.data.paths,e)?o.emit("update"):void 0}},this.tree.on("update",this.handler)}return o(e,t),e.prototype.getWatchedPaths=function(){var t=this;return Object.keys(this.mapping).map(function(e){var r=t.mapping[e];return r instanceof u.default?r.solvedPath:t.mapping[e]}).reduce(function(e,r){if(r=[].concat(r),f.default.dynamicPath(r)&&(r=c.getIn(t.tree._data,r).solvedPath),!r)return e;var n=f.default.monkeyPath(t.tree._monkeys,r);return n?e.concat(c.getIn(t.tree._monkeys,n).data.relatedPaths()):e.concat([r])},[])},e.prototype.getCursors=function(){var t=this,e={};return Object.keys(this.mapping).forEach(function(r){var n=t.mapping[r];n instanceof u.default?e[r]=n:e[r]=t.tree.select(n)}),e},e.prototype.refresh=function(t){if(!f.default.watcherMapping(t))throw c.makeError("Baobab.watch: invalid mapping.",{mapping:t});this.mapping=t;var e={};for(var r in t)e[r]=t[r]instanceof u.default?t[r].path:t[r];this.get=this.tree.project.bind(this.tree,e)},e.prototype.release=function(){this.tree.off("update",this.handler),this.state.killed=!0,this.kill()},e}(s.default);r.default=p,e.exports=r.default},{"./cursor":3,"./helpers":4,"./type":6,emmett:1}]},{},[2])(2)});
>>>>>>> origin/patch-1
